<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Questions</title>
  <style>
    :root {
      --bg: #f6f9fc;
      --card: #fff;
      --accent: #2563eb;
      --muted: #6b7280;
      --border: #e6eef6;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      display: flex;
      min-height: 100vh;
      font-family: Inter, system-ui, Segoe UI, Roboto, -apple-system, Arial, sans-serif;
      background: linear-gradient(180deg, #eef2ff, #f8fafc);
      color: #111;
    }

    aside {
      width: 220px;
      background: var(--card);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 10px;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
    }

    .logo-container {
      height: 50px;
      margin-bottom: 20px;
    }

    .logo-container svg {
      max-height: 100%;
      object-fit: contain;
    }

    nav {
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    nav a {
      text-decoration: none;
      color: var(--muted);
      padding: 10px 16px;
      border-radius: 8px;
      margin: 4px 8px;
      transition: background 0.2s;
    }

    nav a.active,
    nav a:hover {
      background: rgba(37, 99, 235, 0.08);
      color: var(--accent);
      font-weight: 600;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 24px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    header h1 {
      margin: 0;
      font-size: 20px;
    }

    .question-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .question-card {
      background: var(--card);
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: 0 4px 12px rgba(16, 24, 40, 0.08);
      border: 1px solid var(--border);
      transition: all 0.2s;
    }

    .question-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 24, 40, 0.12);
    }

    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .question-header span {
      font-weight: 600;
    }

    .question-actions {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }

    .question-actions button {
      border: 1px solid var(--border);
      background: var(--card);
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
      color: var(--muted);
      transition: background 0.2s;
    }

    .question-actions button:hover {
      background: rgba(37, 99, 235, 0.08);
      color: var(--accent);
    }

    textarea {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px;
      font-size: 15px;
      resize: vertical;
      margin-top: 8px;
    }

    .controls {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }

    .controls button {
      border: none;
      border-radius: 6px;
      padding: 10px 16px;
      font-size: 15px;
      cursor: pointer;
      background: var(--accent);
      color: white;
      transition: background 0.2s;
    }

    .controls button:hover {
      background: #1e40af;
    }

    .tab {
      padding: 8px 12px;
      border-radius: 8px;
      background: transparent;
      border: 1px solid transparent;
      color: var(--muted);
      cursor: pointer
      }

    .tab.active {
      background: rgba(37, 99, 235, 0.08);
      border-color: rgba(37, 99, 235, 0.16);
      color: var(--accent);
      font-weight: 600
    }

    @media (max-width: 640px) {
      aside {
        display: none;
      }
      main {
        padding: 12px;
      }
    }
  </style>
</head>

<body>
  <aside>
    <div class="logo-container">
      <svg width="1215" height="348" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    version="1.1" viewBox="0 0 1215 348">
    <defs>
        <linearGradient id="grad1">
            <stop offset="0%" stop-color="#4d91ff" />
            <stop offset="100%" stop-color="#8257ff" />
        </linearGradient>>
    </defs>
    <circle cx="174" cy="174" r="163" stroke="url(#grad1)" stroke-width="21" fill="none" />
    <path d="M109,272 
C110.84,262.88 112.83,245.22 113,230 
C113.03,227.05 111.91,222.73 110,218 
C107.03,210.77 103,206 103,206 
C98.42,196.78 91,183 91,183 
C88.65,172.58 86,157 86,157 
C86.26,147.48 87,134 87,134 
C88.59,122.48 90.73,116.32 94,110 
C97.54,103.14 102,92.67 107,90 
C110.62,87.34 121,76 129,74 
C138.17,71.68 151,65 151,65 
C162.85,62.05 177.69,60.99 187,62 
C196.62,63.04 212,66 212,66 
C225.07,69.71 234,78 234,78 
C243.97,84.56 255,95 255,95 
C262.72,104.23 267,121 267,121 
C269.27,134.52 270,150 270,150 
C270.31,158.28 270.72,169 271,169 
C272.29,176.65 277,186 277,186 
C280.55,192.27 285,198 285,198 
C284.38,202.62 282,208 282,208 
C280.68,210.16 278.15,211.54 276,212 
C273.85,212.46 269,214 269,214 
C269.33,217.44 270,224 270,224 
C270,230.22 270,237 270,237 
C269.23,240.76 267.15,247 266,247 
C266.33,250.67 267,258 267,258 
C266.22,262.23 264,269 264,269 
C260.67,271.67 252,274 252,274 
C247.21,274.28 239,274 239,274 
C233.17,273.42 223,272 223,272 
C218.27,274.15 211,277 211,277 
C208.77,279.69 207,285 207,285 
C206.58,289.04 206,297 206,297 
C205.39,299.41 204,304 204,304" fill="none" stroke="#6d788e" stroke-width="11" stroke-linecap="round"
        stroke-linejoin="round" />
    <circle cx="120" cy="144" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <circle cx="135" cy="110" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <circle cx="145" cy="169" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <circle cx="164" cy="141" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <circle cx="175" cy="97" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <circle cx="204" cy="140" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <circle cx="214" cy="104" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <circle cx="237" cy="136" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <path d="M163,209
       C164.667,205.833 169.500,195.333 173,190
       C176.500,184.667 180.500,179.667 184,177
       C187.500,174.333 190.667,174.833 194,174
       C197.333,173.167 200.167,173.000 204,172
       C207.833,171.000 213.500,169.667 217,168
       C220.500,166.333 222.000,165.667 225,162
       C228.000,158.333 233.333,148.667 235,146" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <line x1="128" x2="138" y1="153" y2="162" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <line x1="151" x2="159" y1="160" y2="150" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <line x1="124" x2="131" y1="135" y2="120" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <path d="M144,104
       Q155,100 165,99" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <path d="M176,108
       Q176,118 170,132" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <line x1="187" x2="204" y1="98" y2="102" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <line x1="222" x2="232" y1="113" y2="125" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <line x1="226" x2="213" y1="137" y2="139" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <line x1="174" x2="193" y1="140" y2="141" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <text x="390" y="261" font-size="240" text-anchor="start" font-family="Montserrat, sans-serif" font-weight="bold"
        textLength="870" lengthAdjust="spacingAndGlyphs">REAL<tspan dx="-55" fill="#7859ff">16</tspan>
    </text>
</svg>
    </div>
    <nav>
      <a href="/admin/question" class="active">Questions</a>
      <a href="/admin/interview">Interviews</a>
    </nav>
  </aside>

  <main>
    <header>
      <h1>Questions</h1>
      <div id="lang-switch">
            <button id="lang-en" data-lang="en" class="tab">EN</button>
            <button id="lang-ru" data-lang="ru" class="tab">RU</button>
        </div>
    </header>

    <section class="question-list" id="questionList"></section>

    <div class="controls">
      <button id="addBtn">‚ûï Add Question</button>
      <button id="saveBtn">üíæ Save</button>
    </div>
  </main>

  <script>
    const token = localStorage.getItem('token');
    const list = document.getElementById('questionList');
    const addBtn = document.getElementById('addBtn');
    const saveBtn = document.getElementById('saveBtn');
    let currentLang = localStorage.getItem('lang') || 'en';
    const langSwitches = document.querySelectorAll('#lang-switch button');
    let questions = [];
    loadUser();
    loadQuestions();
    langSwitches.forEach(b => b.classList.toggle('active', false));
    document.getElementById('lang-' + currentLang).classList.toggle('active', true);
    function renderQuestions() {
      list.innerHTML = '';
      questions.forEach((question, i) => {
        questions[i].position = i + 1;
        const card = document.createElement('div');
        card.className = 'question-card';
        card.dataset.id = question.id || '';
        card.dataset.position = i + 1;
        card.innerHTML = `
          <div class="question-header">
            <span>Question ${i + 1}</span>
          </div>
          <textarea oninput="updateQuestion(${i})">${question.question}</textarea>
          <div class="question-actions">
            <button onclick="moveUp(${i})">‚¨ÜÔ∏è</button>
            <button onclick="moveDown(${i})">‚¨áÔ∏è</button>
            <button onclick="removeQuestion(${i})">üóëÔ∏è</button>
          </div>
        `;
        list.appendChild(card);
      });
    }

    function addQuestion() {
      questions.push({ "id": null, "question": "", "position": null, "lang": currentLang });
      renderQuestions();
    }

    function moveUp(i) {
      if (i === 0) return;
      [questions[i - 1], questions[i]] = [questions[i], questions[i - 1]];
      renderQuestions();
    }

    function moveDown(i) {
      if (i === questions.length - 1) return;
      [questions[i + 1], questions[i]] = [questions[i], questions[i + 1]];
      renderQuestions();
    }

    function removeQuestion(i) {
      questions.splice(i, 1);
      renderQuestions();
    }

    function saveQuestions() {
      fetch(`/api/admin/question?lang=${encodeURIComponent(currentLang)}`, {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + token
         },
        body: JSON.stringify({ questions })
      })
      .then(r => r.json())
      .then(() => alert('Saved!'))
      .catch(e => alert('Error: ' + e));
    }
    function loadQuestions() {
      console.log('currentLang', currentLang);
      fetch(`/api/admin/question?lang=${encodeURIComponent(currentLang)}`, {
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + token
        }
      })
      .then(r => r.json())
      .then(data => {
        questions = data.questions || [];
        renderQuestions();
      });
    }
    addBtn.addEventListener('click', addQuestion);
    saveBtn.addEventListener('click', saveQuestions);
    async function loadUser() {
      const resp = await fetch(
        '/api/user', {
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + token
        }
      });
      if (resp.ok) {
        const user = await resp.json();
      } else {
        window.location.href = '/admin';
      }
    }
    function updateQuestion(i) {
      const textarea = list.querySelectorAll('textarea')[i];
      questions[i].question = textarea.value;
    }
    langSwitches.forEach(btn => {
      btn.addEventListener('click', () => {
        langSwitches.forEach(b => b.classList.toggle('active', false));
        btn.classList.toggle('active', true);
        currentLang = btn.dataset.lang;
        localStorage.setItem('lang', currentLang);
        loadQuestions();
      });
    });
  </script>
</body>
</html>
