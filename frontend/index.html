<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title id="title">Passwordless Sign In</title>
    <style>
        :root {
            --bg: #f6f9fc;
            --card: #fff;
            --accent: #2563eb;
            --muted: #6b7280
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: Inter, system-ui, Segoe UI, Roboto, -apple-system, Arial, sans-serif;
            background: linear-gradient(180deg, #eef2ff, #f8fafc);
            color: #111
        }

        header {
            text-align: center;
            padding: 4px 20px;
        }

        .logo-container {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
        }

        .logo-container svg {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
        }

        .wrap {
            max-width: 760px;
            margin: 3vh auto;
            padding: 24px
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 28px;
            box-shadow: 0 6px 20px rgba(16, 24, 40, 0.08)
        }

        h1 {
            margin: 0 0 6px;
            font-size: 20px
        }

        p.lead {
            margin: 0 0 18px;
            color: var(--muted)
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 18px
        }

        .tab {
            padding: 8px 12px;
            border-radius: 8px;
            background: transparent;
            border: 1px solid transparent;
            color: var(--muted);
            cursor: pointer
        }

        .tab.active {
            background: rgba(37, 99, 235, 0.08);
            border-color: rgba(37, 99, 235, 0.16);
            color: var(--accent);
            font-weight: 600
        }

        form .field {
            display: block;
            flex-direction: column;
            margin-bottom: 12px
        }

        label {
            font-size: 13px;
            color: var(--muted);
            margin-bottom: 6px
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"] {
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #e6eef6;
            font-size: 15px
        }

        .actions {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 12px
        }

        button.primary {
            background: var(--accent);
            color: #fff;
            border: 0;
            padding: 10px 14px;
            border-radius: 8px;
            cursor: pointer
        }

        button.ghost {
            background: transparent;
            border: 1px solid #e6eef6;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer
        }

        .hint {
            color: var(--muted);
            font-size: 13px;
            margin-left: 8px
        }

        .status {
            margin-top: 12px;
            color: var(--muted);
            font-size: 14px
        }

        .otp-box {
            display: flex;
            gap: 8px;
            margin-top: 12px
        }

        .otp-box input {
            width: 3rem;
            text-align: center;
            font-size: 18px;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #e6eef6
        }

        footer {
            margin-top: 18px;
            color: var(--muted);
            font-size: 13px
        }

        @media (max-width:640px) {
            .wrap {
                padding: 12px
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="logo-container">
            <svg width="1215" height="348" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    version="1.1" viewBox="0 0 1215 348">
    <defs>
        <linearGradient id="grad1">
            <stop offset="0%" stop-color="#4d91ff" />
            <stop offset="100%" stop-color="#8257ff" />
        </linearGradient>>
    </defs>
    <circle cx="174" cy="174" r="163" stroke="url(#grad1)" stroke-width="21" fill="none" />
    <path d="M109,272 
C110.84,262.88 112.83,245.22 113,230 
C113.03,227.05 111.91,222.73 110,218 
C107.03,210.77 103,206 103,206 
C98.42,196.78 91,183 91,183 
C88.65,172.58 86,157 86,157 
C86.26,147.48 87,134 87,134 
C88.59,122.48 90.73,116.32 94,110 
C97.54,103.14 102,92.67 107,90 
C110.62,87.34 121,76 129,74 
C138.17,71.68 151,65 151,65 
C162.85,62.05 177.69,60.99 187,62 
C196.62,63.04 212,66 212,66 
C225.07,69.71 234,78 234,78 
C243.97,84.56 255,95 255,95 
C262.72,104.23 267,121 267,121 
C269.27,134.52 270,150 270,150 
C270.31,158.28 270.72,169 271,169 
C272.29,176.65 277,186 277,186 
C280.55,192.27 285,198 285,198 
C284.38,202.62 282,208 282,208 
C280.68,210.16 278.15,211.54 276,212 
C273.85,212.46 269,214 269,214 
C269.33,217.44 270,224 270,224 
C270,230.22 270,237 270,237 
C269.23,240.76 267.15,247 266,247 
C266.33,250.67 267,258 267,258 
C266.22,262.23 264,269 264,269 
C260.67,271.67 252,274 252,274 
C247.21,274.28 239,274 239,274 
C233.17,273.42 223,272 223,272 
C218.27,274.15 211,277 211,277 
C208.77,279.69 207,285 207,285 
C206.58,289.04 206,297 206,297 
C205.39,299.41 204,304 204,304" fill="none" stroke="#6d788e" stroke-width="11" stroke-linecap="round"
        stroke-linejoin="round" />
    <circle cx="120" cy="144" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <circle cx="135" cy="110" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <circle cx="145" cy="169" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <circle cx="164" cy="141" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <circle cx="175" cy="97" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <circle cx="204" cy="140" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <circle cx="214" cy="104" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <circle cx="237" cy="136" r="9" fill="none" stroke="#6d788e" stroke-width="10" />
    <path d="M163,209
       C164.667,205.833 169.500,195.333 173,190
       C176.500,184.667 180.500,179.667 184,177
       C187.500,174.333 190.667,174.833 194,174
       C197.333,173.167 200.167,173.000 204,172
       C207.833,171.000 213.500,169.667 217,168
       C220.500,166.333 222.000,165.667 225,162
       C228.000,158.333 233.333,148.667 235,146" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <line x1="128" x2="138" y1="153" y2="162" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <line x1="151" x2="159" y1="160" y2="150" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <line x1="124" x2="131" y1="135" y2="120" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <path d="M144,104
       Q155,100 165,99" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <path d="M176,108
       Q176,118 170,132" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <line x1="187" x2="204" y1="98" y2="102" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <line x1="222" x2="232" y1="113" y2="125" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <line x1="226" x2="213" y1="137" y2="139" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <line x1="174" x2="193" y1="140" y2="141" fill="none" stroke="#6d788e" stroke-width="10" stroke-linecap="round"
        stroke-linejoin="round" />
    <text x="390" y="261" font-size="240" text-anchor="start" font-family="Montserrat, sans-serif" font-weight="bold"
        textLength="870" lengthAdjust="spacingAndGlyphs">
        REAL
        <tspan dx="-70" fill="#7859ff">16</tspan>
    </text>
</svg>
        </div>
        <div id="lang-switch">
            <button id="lang-en" data-lang="en" class="tab">EN</button>
            <button id="lang-ru" data-lang="ru" class="tab">RU</button>
        </div>
    </header>
    <div class="wrap">
        <section class="hero">
            <h1 id="welcome-title"></h1>
            <p id="welcome-text"></p>
            <p id="auth-text"></p>
        </section>
        <div class="card" role="main">
            <h1 id="auth-title"></h1>
            <p id="auth-lead" class="lead"></p>

            <div class="tabs" role="tablist">
                <button class="tab active" id="tab-email" data-mode="email" role="tab"
                    aria-selected="true">Email</button>
                <button class="tab" id="tab-phone" data-mode="phone" role="tab"></button>
            </div>

            <form id="authForm" autocomplete="off">
                <div class="field" id="field-email">
                    <label for="email">Email</label>
                    <input id="email" name="email" type="email" placeholder="you@example.com" required />
                </div>

                <div class="field" id="field-phone" style="display:none">
                    <label id="phone-label" for="phone"></label>
                    <input id="phone" name="phone" type="tel" placeholder="+0 000 000 0000" />
                </div>

                <div class="actions">
                    <button class="primary" id="sendBtn" type="submit"></button>
                    <div id="passwordless-hint"class="hint"></div>
                </div>

                <div class="status" id="status">&nbsp;</div>

                <div id="otpArea" style="display:none">
                    <div class="field">
                        <label id="otp-label"></label>
                        <div class="otp-box" id="otpInputs">
                            <input inputmode="numeric" maxlength="1" />
                            <input inputmode="numeric" maxlength="1" />
                            <input inputmode="numeric" maxlength="1" />
                            <input inputmode="numeric" maxlength="1" />
                            <input inputmode="numeric" maxlength="1" />
                            <input inputmode="numeric" maxlength="1" />
                        </div>
                    </div>
                    <div class="actions">
                        <button class="primary" id="verifyBtn" type="button"></button>
                    </div>
                </div>

            </form>

            <footer id="footer"></footer>
        </div>
    </div>

    <script>
        const tabEmail = document.getElementById('tab-email');
        const tabPhone = document.getElementById('tab-phone');
        const fieldEmail = document.getElementById('field-email');
        const fieldPhone = document.getElementById('field-phone');
        const authForm = document.getElementById('authForm');
        const sendBtn = document.getElementById('sendBtn');
        const statusEl = document.getElementById('status');
        const otpArea = document.getElementById('otpArea');
        const verifyBtn = document.getElementById('verifyBtn');
        const otpInputs = document.getElementById('otpInputs');
        const currentLang = localStorage.getItem('lang') || 'en';
        const langSwitches = document.querySelectorAll('#lang-switch button');
        const inputEmail = document.getElementById('email');
        const inputPhone = document.getElementById('phone');

        let mode = 'email';
        let lastIdentifier = null;
        let translations = {};

        function setMode(m) {
            mode = m;
            tabEmail.classList.toggle('active', m === 'email');
            tabPhone.classList.toggle('active', m === 'phone');
            inputEmail.required = m === 'email';
            inputPhone.required = m === 'phone';
            fieldEmail.style.display = m === 'email' ? 'block' : 'none';
            fieldPhone.style.display = m === 'phone' ? 'block' : 'none';
            statusEl.textContent = ''; otpArea.style.display = 'none';
        }

        tabEmail.addEventListener('click', () => setMode('email'));
        tabPhone.addEventListener('click', () => setMode('phone'));
        langSwitches.forEach(btn => {
            btn.addEventListener('click', () => {
                langSwitches.forEach(b => b.classList.toggle('active', false));
                btn.classList.toggle('active', true);
                const currentLang = btn.dataset.lang;
                localStorage.setItem('lang', currentLang);
                loadLang(currentLang);
            });
        });

        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            sendBtn.disabled = true;
            statusEl.textContent = translations.sending_code;
            const payload = {};
            if (mode === 'email') payload.email = document.getElementById('email').value.trim();
            else payload.phone = document.getElementById('phone').value.trim();
            lastIdentifier = payload.email || payload.phone;

            try {
                const resp = await fetch('/api/auth/passwordless/send', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)
                });
                const data = await resp.json();
                if (resp.ok) {
                    console.log('data', data);
                    statusEl.textContent = translations[data.message] || translations.code_sent;
                    otpArea.style.display = 'block';
                    focusOtp();
                } else {
                    statusEl.textContent = translations[data.error] || translations.error + ': ' + resp.status;
                }
            } catch (err) { statusEl.textContent = translations.net_error + ': ' + err.message; }
            sendBtn.disabled = false;
        });

        verifyBtn.addEventListener('click', async () => {
            const code = Array.from(otpInputs.querySelectorAll('input')).map(i => i.value).join('');
            if (!code || code.length < 6) { statusEl.textContent = translations.code_error; return; }
            verifyBtn.disabled = true; statusEl.textContent = translations.verifying;
            try {
                const resp = await fetch(
                    '/api/auth/passwordless/verify',
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ identifier: lastIdentifier, code })
                    }
                );
                const data = await resp.json();
                if (resp.ok) {
                    statusEl.textContent = translations.success_and_redirect;
                    // пример: сервер вернёт JWT или установит сессионный cookie и redirect
                    localStorage.setItem('token', data.token);
                    // console.log('data', data.token);
                    window.location.href = '/cameraquestions';
                    if (data.redirect) window.location.href = data.redirect; else console.log('token', data.token);
                } else { statusEl.textContent = translations[data.error] || translations.wrong_code; }
            } catch (err) { statusEl.textContent = translations.net_error; }
            verifyBtn.disabled = false;
        });

        // focus helpers
        function focusOtp() { const first = otpInputs.querySelector('input'); if (first) first.focus(); }
        otpInputs.addEventListener('input', (e) => {
            const t = e.target;
            if (t.value.length === 1) {
                const next = t.nextElementSibling;
                if (next) next.focus();
            }
        });

        // basic client validation (email/phone)
        function isValidEmail(e) { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }
        function isValidPhone(p) { return /^\+?[0-9\s\-()]{7,15}$/.test(p); }

        // simple UX: prevent sending invalid
        document.getElementById('email').addEventListener('input', () => {
            const v = document.getElementById('email').value;
            sendBtn.disabled = !(isValidEmail(v));
        });
        document.getElementById('phone').addEventListener('input', () => {
            const v = document.getElementById('phone').value;
            sendBtn.disabled = !(isValidPhone(v));
        });

        // initial disable until input
        sendBtn.disabled = true;
        loadLang(currentLang);
        function loadLang(lang) {
            fetch(`/lang/${lang}.json`)
            .then(r => r.json())
            .then(t => {
                translations = t;
                statusEl.textContent = '';
                document.getElementById('title').textContent = t.title;
                document.getElementById('auth-title').textContent = t.auth_title;
                document.getElementById('welcome-title').textContent = t.welcome_title;
                document.getElementById('welcome-text').textContent = t.welcome_text;
                document.getElementById('auth-text').textContent = t.auth_text;
                document.getElementById('auth-lead').textContent = t.auth_lead;
                tabPhone.textContent = t.tab_phone;
                document.getElementById('phone-label').textContent = t.phone_label;
                sendBtn.textContent = t.send_btn;
                document.getElementById('passwordless-hint').textContent = t.passwordless_hint;
                document.getElementById('otp-label').textContent = t.otp_label;
                verifyBtn.textContent = t.verify_btn;
                langSwitches.forEach(b => b.classList.toggle('active', false));
                document.getElementById('lang-' + lang).classList.toggle('active', true);
            });
        }
    </script>
</body>

</html>